<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>AgendaProfesionales - Reserva tu hora online</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <!-- HEADER -->
  <header class="bg-green-700 text-white">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center justify-between">
      <div class="flex items-center gap-2">
        <div class="w-8 h-8 rounded-full bg-white/10 flex items-center justify-center text-sm font-bold">
          AP
        </div>
        <div>
          <h1 class="text-lg font-bold">AgendaProfesionales</h1>
          <p class="text-xs text-green-100">
            Reservas online para profesionales independientes
          </p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <a href="login.html"
           class="text-xs sm:text-sm border border-white/60 px-3 py-1 rounded hover:bg-white hover:text-green-700 transition">
          Soy profesional
        </a>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="flex-1">
    <section class="bg-white border-b">
      <div class="max-w-6xl mx-auto px-4 py-8 grid md:grid-cols-2 gap-6 items-center">
        <div>
          <h2 class="text-3xl font-bold text-gray-900 mb-3">
            Encuentra a tu profesional y reserva en segundos
          </h2>
          <p class="text-gray-600 mb-4 text-sm sm:text-base">
            Kinesi√≥logos, masoterapeutas, entrenadores, psic√≥logos y m√°s.
            Revisa sus datos y agenda tu hora online sin llamadas ni WhatsApp.
          </p>

          <ul class="text-sm text-gray-700 space-y-1 mb-4">
            <li>‚Ä¢ Ver disponibilidad en tiempo real</li>
            <li>‚Ä¢ Confirmaci√≥n inmediata de tu cita</li>
            <li>‚Ä¢ Link directo de cada profesional</li>
          </ul>

          <p class="text-xs text-gray-500">
            * Esta plataforma est√° pensada para profesionales independientes y peque√±as escuelas.
          </p>
        </div>

        <div class="bg-green-50 border border-green-100 rounded-xl p-4 text-sm text-gray-700">
          <p class="font-semibold text-green-800 mb-2">
            ¬øEres profesional y quieres usar AgendaProfesionales?
          </p>
          <p class="mb-2">
            Reg√≠strate, configura tus horarios y comparte tu link de reserva con tus pacientes.
          </p>
          <a href="registro-profesional.html"
             class="inline-block mt-2 text-xs font-semibold bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded">
            Ir a panel de profesional
          </a>
        </div>
      </div>
    </section>

    <!-- BUSCADOR Y FILTROS -->
    <section class="max-w-6xl mx-auto px-4 py-6">
      <div class="flex flex-col gap-3 sm:flex-row sm:items-end mb-4">
        <div class="flex-1">
          <label class="block text-xs font-medium text-gray-700 mb-1">
            Buscar profesional
          </label>
          <input id="buscarProf"
                 type="text"
                 placeholder="Ej: Juan, kinesi√≥logo, correo..."
                 class="border rounded-lg px-3 py-2 text-sm w-full" />
        </div>

        <div class="w-full sm:w-64">
          <label class="block text-xs font-medium text-gray-700 mb-1">
            Especialidad
          </label>
          <select id="filtroEsp"
                  class="border rounded-lg px-3 py-2 text-sm w-full">
            <option value="">Todas las especialidades</option>
          </select>
        </div>
      </div>

      <p id="msgProfesionales" class="text-sm mb-4"></p>

      <!-- LISTADO DE PROFESIONALES -->
      <div id="listaProfesionales"
           class="grid gap-4 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
        <!-- Tarjetas din√°micas -->
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="mt-8 py-4 border-t text-center text-xs text-gray-500">
    AgendaProfesionales &copy; 2025 ‚Äî Proyecto en desarrollo
  </footer>

  <!-- Config global de API (adaptativo local / GitHub Pages) -->
  <script src="js/config.js"></script>

  <script>
    // Usa la URL del backend definida en config.js, o cae al origen actual (√∫til en local)
    const BASE_URL = window.API_BASE_URL || window.location.origin;

    const msgProfesionales = document.getElementById("msgProfesionales");
    const listaProfesionales = document.getElementById("listaProfesionales");
    const buscarProf = document.getElementById("buscarProf");
    const filtroEsp = document.getElementById("filtroEsp");

    let profesionalesCache = [];

    function renderProfesionales() {
      const texto = buscarProf.value.trim().toLowerCase();
      const esp = filtroEsp.value;

      let filtrados = [...profesionalesCache];

      // üîç Buscar por nombre, especialidad o email
      if (texto) {
        filtrados = filtrados.filter((p) => {
          const nombre = (p.nombre || "").toLowerCase();
          const especialidad = (p.especialidad || "").toLowerCase();
          const email = (p.email || "").toLowerCase();
          return (
            nombre.includes(texto) ||
            especialidad.includes(texto) ||
            email.includes(texto)
          );
        });
      }

      // Filtro por especialidad exacta
      if (esp) {
        filtrados = filtrados.filter((p) => p.especialidad === esp);
      }

      if (!filtrados.length) {
        listaProfesionales.innerHTML = `
          <p class="text-gray-500 text-sm col-span-full">
            No se encontraron profesionales con esos filtros.
          </p>
        `;
        return;
      }

      listaProfesionales.innerHTML = "";
      filtrados.forEach((p) => {
        const card = document.createElement("div");
        card.className =
          "bg-white shadow-sm hover:shadow-md border border-gray-100 rounded-xl p-4 flex flex-col justify-between transition";

        const nombre = p.nombre || "Profesional sin nombre";
        const especialidad = p.especialidad || "Profesional independiente";
        const email = p.email || "Sin email registrado";

        card.innerHTML = `
          <div>
            <h3 class="text-lg font-semibold text-green-700 mb-1">
              ${nombre}
            </h3>
            <p class="text-sm text-gray-700 mb-1">
              ${especialidad}
            </p>
            <p class="text-xs text-gray-500 mb-2">
              ${email}
            </p>
          </div>
          <div class="mt-3 flex justify-between items-center">
            <span class="text-[11px] text-gray-400">
              Reserva con este profesional
            </span>
            <a href="agendar.html?profesionalId=${p.id}"
               class="inline-block bg-green-600 hover:bg-green-700 text-white text-xs font-semibold px-3 py-1 rounded">
              Agendar hora
            </a>
          </div>
        `;

        listaProfesionales.appendChild(card);
      });
    }

    async function cargarProfesionales() {
      msgProfesionales.textContent = "Cargando profesionales...";
      msgProfesionales.className = "text-sm mb-4 text-gray-600";

      try {
        const res = await fetch(`${BASE_URL}/profesionales`);
        const profesionales = await res.json();

        profesionalesCache = Array.isArray(profesionales)
          ? profesionales.filter((p) => (p.rol || "").toLowerCase() === "profesional")
          : [];

        // Llenar select de especialidades
        const especialidades = Array.from(
          new Set(
            profesionalesCache
              .map((p) => p.especialidad)
              .filter((e) => e && e.trim() !== "")
          )
        ).sort();

        filtroEsp.innerHTML =
          `<option value="">Todas las especialidades</option>` +
          especialidades
            .map((e) => `<option value="${e}">${e}</option>`)
            .join("");

        if (profesionalesCache.length === 0) {
          msgProfesionales.textContent = "A√∫n no hay profesionales registrados.";
        } else {
          msgProfesionales.textContent = `${profesionalesCache.length} profesional(es) disponibles.`;
        }

        msgProfesionales.className = "text-sm mb-4 text-gray-600";

        renderProfesionales();
      } catch (err) {
        console.error(err);
        msgProfesionales.textContent =
          "Error cargando profesionales. Intenta nuevamente m√°s tarde.";
        msgProfesionales.className = "text-sm mb-4 text-red-500";
        listaProfesionales.innerHTML = "";
      }
    }

    buscarProf.addEventListener("input", renderProfesionales);
    filtroEsp.addEventListener("change", renderProfesionales);

    window.addEventListener("DOMContentLoaded", cargarProfesionales);
  </script>
</body>
</html>
